{% extends 'main.html' %}

  {% block content %}
    
    {% load f_extras %}

  	<ul class="nav nav-pills justify-content-center">
      <li class="nav-item">
        {% url 'start_project' data.id as start_project %}
        <a class="nav-link {% if start_project == request.path %} active {% endif %}" href="{% url 'start_project' data.id %}">Начальная страница</a>
      </li>
      <li class="nav-item">
        {% url 'const_start' data.id as const_start %}
        <a class="nav-link {% if const_start == request.path %} active {% endif %}" href="{% url 'const_start' data.id %}">Подбор констант</a>
      </li>
      <li class="nav-item">
        {% url 'clustering_start' data.id as clustering_start %}
        {% if data.stage >= 3 %}
        <a class="nav-link {% if clustering_start == request.path %} active {% endif %}" href="{% url 'clustering_start' data.id %}">Кластеризация</a>
        {% else %}
        <p class="nav-link {% if clustering_start == request.path %} active {% endif %}" href="{% url 'clustering_start' data.id %}">Кластеризация</p>
        {% endif %}
      </li>
      <li class="nav-item">
        {% url 'classification_start' data.id as classification_start %}
        {% if data.stage == 4 %}
        <a class="nav-link {% if classification_start == request.path %} active {% endif %}" href="{% url 'classification_start' data.id %}">Классификация</a>
        {% else %}
        <p class="nav-link {% if classification_start == request.path %} active {% endif %}" href="{% url 'classification_start' data.id %}">Классификация</p>
        {% endif %}
      </li>


  	<div class="container">

      <p><a href="{% url 'table' data.id %}">Посмотреть данные</a></p>
      <hr/>

      <p><a href="{% url 'download_data' data.id %}">Скачать данные</a></p>
      <hr/>

      <p><a href="{% url 'download_settings' data.id %}">Скачать константы</a></p>
      <hr/>

      <p><a href="{% url 'const_reload' data.id %}">Обнулисть костанты</a></p>
      <hr/>

      <form action="{% url 'const_start' data.id %}" method="post" id="save">
        {% csrf_token %}


        {% for col in columns %}
          <p>
            <input name="need_coords" class="form-check-input" type="checkbox" value="{{col.0}}" id="flexCheckDefault" {% if col.1 %} checked {% endif %}>
            <label class="form-check-label" for="flexCheckDefault">
              {{col.0}}
            </label>
          </p> 
        {% endfor %}


        <h3>Consts</h3>
          <p title='Шаг по Y (только 2 способ)'>Y_step
          <input name="Y_step" type="number" step="any" value={{settings.consts.Y_step}}></p>
          <p title='Начальная константа при подборе а'>const
          <input name="const" type="number" step="any" value={{settings.consts.const}}></p>
          <p title='Количество шагов вниз по степени для 3-го способа'>down_steps
          <input name="down_steps" type="number" step="any" value={{settings.consts.down_steps}}></p>
          <p title='Максимальное количество шагов для 4-го способа'>max_depth
          <input name="max_depth" type="number" step="any" value={{settings.consts.max_depth}}></p>
          <p title='Процент расстоний, который учитывается'>percent_X
          <input name="percent_X" type="number" step="any" value={{settings.consts.percent_X}}></p>
          <p title='Процент расстоний, который учитывается'>percent_Y
          <input name="percent_Y" type="number" step="any" value={{settings.consts.percent_Y}}></p>
          <p title='Процент F, который учитывается для 1-го способа'>percent_for_norms
          <input name="percent_for_norms" type="number" step="any" value={{settings.consts.percent_for_norms}}></p>
          <p title='Процент нулевых расстояний, больше которого не будет браться'>percent_of_zeros
          <input name="percent_of_zeros" type="number" step="any" value={{settings.consts.percent_of_zeros}}></p>
          <p title='Константа округления'>round_const
          <input name="round_const" type="number" step="any" value={{settings.consts.round_const}}></p>
          <p title='Порог для 2-го способа'>threshold
          <input name="threshold" type="number" step="any" value={{settings.consts.threshold}}></p>
          <p title='Количество шагов вверх по степени для 3-го способа'>up_steps
          <input name="up_steps" type="number" step="any" value={{settings.consts.up_steps}}></p>
          {% if settings.consts.a %}
            <p style="color:red" title='Итоговое а'>a
            <input name="a" type="number" step="any" value={{settings.consts.a}}></p>
          {% endif %}
          {% if not const_status%}
            <p style="color:red" title='Стартовое а'>started a
            <input name="started_a" type="number" step="any"></p>
          {% endif %}
        <h3>conturs</h3>
          <p title='?'>min_points
          <input name="min_points" type="number" step="any" value={{settings.conturs.min_points}}></p>
          <p title='?'>contour_points
          <input name="contour_points" type="number" step="any" value={{settings.conturs.contour_points}}></p>
          <p title='?'>num_of_lenghts
          <input name="num_of_lenghts" type="number" step="any" value={{settings.conturs.num_of_lenghts}}></p>
          
          {% if settings.conturs.min_diff|length > 0 %}
            <p title='?'>min_diff</p>
            <p><input name="min_diff_0" type="number" step="any" value={{settings.conturs.min_diff.0}}></p>
            <p><input name="min_diff_1" type="number" step="any" value={{settings.conturs.min_diff.1}}></p>
          {% else %}
            <p title='?'>min_diff
            <input name="min_diff" type="number" step="any" value={{settings.conturs.min_diff}}></p>
          {% endif %}

        <h3>isolated_cluster</h3>
          <p title='?'>constU1
          <input name="constU1" type="number" step="any" value={{settings.isolated_cluster.constU1}}></p>
          <p title='Минимальная длина между 2 точками для рассчета профилей'>min_len
          <input name="min_len" type="number" step="any" value={{settings.isolated_cluster.min_len}}></p>
          <p title='?'>divider
          <input name="divider" type="number" step="any" value={{settings.isolated_cluster.divider}}></p>
          <p title='Порог для мерджинга'>merge_threshold
          <input name="merge_threshold" type="number" step="any" value={{settings.isolated_cluster.merge_threshold}}></p>
          <p title='Максимальное количество делейний при расчете профилей (контрольные уровни)'>max_div_num
          <input name="max_div_num" type="number" step="any" value={{settings.isolated_cluster.max_div_num}}></p>
          {% if settings.isolated_cluster.min_dif|length > 0 %}
            <p title='?'>min_dif</p>
            <p><input name="min_dif_0" type="number" step="any" value={{settings.isolated_cluster.min_dif.0}}></p>
            <p><input name="min_dif_1" type="number" step="any" value={{settings.isolated_cluster.min_dif.1}}></p>
          {% else %}
            <p title='?'>min_dif
            <input name="min_dif" type="number" step="any" value={{settings.isolated_cluster.min_dif}}></p>
          {% endif %}

        {% if settings.norms %}
          <h3>norms</h3>
            {% for norm in settings.norms %}
              <p>{{norm}}
              <input name={{norm}} type="number" step="any" value={{ settings.norms|get_item:norm }}></p>
            {% endfor %}
        {% endif %}
      </form>

      <p><button form="save" type="submit" class="btn btn-primary mt-4">Сохранить</button></p>

      <p><a href="{% url 'calculate_a' data.id 0 %}">Нулевой способ</a></p>
      <p><a href="{% url 'calculate_a' data.id 1 %}">Первый способ</a></p>
      <p><a href="{% url 'calculate_a' data.id 2 %}">Второй способ</a></p>
      <p><a href="{% url 'calculate_a' data.id 3 %}">Третий способ</a></p>
      <p><a href="{% url 'calculate_a' data.id 4 %}">Четвертый способ</a></p>

      <textarea name="text" cols="40" rows="15">{{data.comments}}</textarea>
      {% if settings.consts.a %}
        <a href="{% url 'clustering_start' data.id %}">Далее</a>
      {% endif %}

  	</div>
  {% endblock %}
